<!--create-new_asset-->

{% extends "base.html" %}
{% block title %}{{ 'Edit' if editing else 'Add New' }} Asset | Asset Management System{% endblock %}

  {% block content %}
  <div class="d-flex justify-content-center mt-4">
    <div class="card shadow-sm" style="width: 100%; max-width: 800px;">
      <div class="card-header text-white" style="background-color: #043251;">
        <h5 class="mb-0 text-center">{{ 'Edit' if editing else 'Add New' }} Asset</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('main.create_asset') if not editing else url_for('main.edit_asset', asset_id=asset_id) }}" autocomplete="off" id="asset-form">
          {{ form.csrf_token }}

          <!-- Asset Type -->
          <div class="mb-3">      
            <label for="asset_type" class="form-label">Asset Type</label>
            <select id="asset_type" name="category" class="form-select">
              <option value="" disabled selected>Select a type</option>
              {% for type in types %}
                <option value="{{ type }}" {% if asset_data.category == type %}selected{% endif %}>{{ type }}</option>
              {% endfor %}
              <option value="add_new_type">Add New Type</option>
            </select>
            <div class="invalid-feedback" id="category-error"></div>
          </div>

          <!-- New Type Name -->
          <div class="mb-3" id="new-type-wrapper" hidden>
            <label for="new-type" class="form-label">New Type Name</label>
            <input type="text" id="new-type" name="new_type" class="form-control" placeholder="e.g. Scanner">
            <div class="invalid-feedback" id="new-type-error"></div>
          </div>

          <!-- Feature Selector -->
          <div class="mb-3" id="feature-select-wrapper" hidden>
            <label class="form-label">Select Fields for New Type</label>
            <div id="available-feature-list" class="border rounded p-2" style="max-height: 200px; overflow-y: auto;"></div>
          </div>
          
          <button type="button" class="btn btn-outline-primary mt-2" id="create-form-btn" hidden>
            <i class="bi bi-tools me-1"></i> Create Form from Selected Fields
          </button> 
          

          <!-- Dynamic Fields -->
          <div id="dynamic-fields"></div>

          <div id="status-remarks-section" hidden></div>

          <!-- Hidden Fields -->
          <input type="hidden" name="selected_features" id="selected_features">
          <input type="hidden" name="custom_fields" id="custom_fields">

          <button type="submit" class="btn w-100 mt-3" id="submit-btn" disabled>
            <i class="bi bi-save me-1"></i> Save Asset
          </button>
        </form>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script>
  window.existingAssetData = {{ asset_data | default({}) | tojson | safe }};
  window.masterFields = {{ master_fields | default([]) | tojson | safe }};
  window.fieldsToRender = {{ fields_to_render | default([]) | tojson | safe }};
</script> 

<script defer src="{{ url_for('main.serve_assets', filename='bundle.js') }}"></script>

{% endblock %}


